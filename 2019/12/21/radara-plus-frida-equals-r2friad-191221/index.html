<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言 演示例子:   Sina Weibo Xiao Hongshu  参考资料: r2wiki、enovella wiki  正文0x1 安装首先安装radare2，Windows用户可以在这里下载可执行文件安装 然后安装r2frida，自行克隆安装 用frida-ls-devices工具获取 usb device id   接着用frida-ps -U | grep xhs获取完整包名 然后根">
<meta property="og:type" content="article">
<meta property="og:title" content="RADARE2+FRIDA&#x3D;R2FRIDA Your Best Dynamic Debugging Tool">
<meta property="og:url" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/index.html">
<meta property="og:site_name" content="0x2h">
<meta property="og:description" content="前言 演示例子:   Sina Weibo Xiao Hongshu  参考资料: r2wiki、enovella wiki  正文0x1 安装首先安装radare2，Windows用户可以在这里下载可执行文件安装 然后安装r2frida，自行克隆安装 用frida-ls-devices工具获取 usb device id   接着用frida-ps -U | grep xhs获取完整包名 然后根">
<meta property="og:locale">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_ls_devices.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_java_newCalculateS_01.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_newCalculateS.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getOriginalString.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getKeyString.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_getIndex.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/ida_pro_sub_451c.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_mbedtls_decode_output.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/mbedtls_des_crypt_ecb_doc.png">
<meta property="og:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/mbedtls_des_setkey_dec_doc.png">
<meta property="article:published_time" content="2019-12-21T09:11:23.000Z">
<meta property="article:modified_time" content="2019-12-21T13:48:08.000Z">
<meta property="article:author" content="0x2h">
<meta property="article:tag" content="frida">
<meta property="article:tag" content="r2frida">
<meta property="article:tag" content="radare2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/images/frida_ls_devices.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/01/13/java-class-format-notes-200113/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/12/03/dy-end-191203/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&text=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&is_video=false&description=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&body=Check out this article: http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&name=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">0x1 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">0x2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-1-gt-help"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">0x2.1&gt; help</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-2-gt-dm"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">0x2.2&gt; dm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-3-gt-iE"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">0x2.3&gt; iE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-24-gt"><span class="toc-number">2.2.0.4.</span> <span class="toc-text">0x.24&gt; \&#x2F;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-Dynamic"><span class="toc-number">2.3.</span> <span class="toc-text">0x3 Dynamic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x3-1-gt-dma"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">0x3.1&gt; dma</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-gt-dtf-trace-function-from-address"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.2&gt; dtf (trace function from address)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x4-Memory"><span class="toc-number">3.</span> <span class="toc-text">0x4 Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-1-getOriginalString"><span class="toc-number">3.1.</span> <span class="toc-text">0x4.1 getOriginalString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-2-getKeyString"><span class="toc-number">3.2.</span> <span class="toc-text">0x4.2 getKeyString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-3-getIndex"><span class="toc-number">3.3.</span> <span class="toc-text">0x4.3 getIndex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-4-g-pin%E3%80%81g-from"><span class="toc-number">3.4.</span> <span class="toc-text">0x4.4 g_pin、g_from</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-5-sub-451C"><span class="toc-number">3.5.</span> <span class="toc-text">0x4.5 sub_451C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x5-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="toc-number">4.</span> <span class="toc-text">0x5 算法还原</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">4.0.1.</span> <span class="toc-text">Java:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Golang"><span class="toc-number">4.0.2.</span> <span class="toc-text">Golang:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%EF%BC%88sha512-h%E5%A4%AA%E9%95%BF%E4%BA%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%8E%BBgithub%E4%B8%8B%E8%BD%BD%E6%8A%8A%EF%BC%89"><span class="toc-number">4.0.3.</span> <span class="toc-text">C++（sha512.h太长了，直接去github下载把）:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">4.0.4.</span> <span class="toc-text">Python:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">5.</span> <span class="toc-text">最后</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">0x2h</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-12-21T09:11:23.000Z" itemprop="datePublished">2019-12-21</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/frida/" rel="tag">frida</a>, <a class="tag-link-link" href="/tags/r2frida/" rel="tag">r2frida</a>, <a class="tag-link-link" href="/tags/radare2/" rel="tag">radare2</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>演示例子: </p>
<ul>
<li>Sina Weibo</li>
<li>Xiao Hongshu</li>
</ul>
<p>参考资料: <a target="_blank" rel="noopener" href="https://r2wiki.readthedocs.io/en/latest/radare-plugins/frida/">r2wiki</a>、<a target="_blank" rel="noopener" href="https://github.com/enovella/r2frida-wiki">enovella wiki</a></p>
</blockquote>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="0x1-安装"><a href="#0x1-安装" class="headerlink" title="0x1 安装"></a>0x1 安装</h2><p>首先安装<a target="_blank" rel="noopener" href="https://github.com/radareorg/radare2">radare2</a>，Windows用户可以在这里<a target="_blank" rel="noopener" href="https://radare.mikelloc.com/list">下载</a>可执行文件安装</p>
<p>然后安装<a target="_blank" rel="noopener" href="https://github.com/nowsecure/r2frida">r2frida</a>，自行克隆安装</p>
<p>用<code>frida-ls-devices</code>工具获取 <code>usb device id</code> </p>
<p><img src="images/frida_ls_devices.png"></p>
<p>接着用<code>frida-ps -U | grep xhs</code>获取完整包名</p>
<p>然后根据<code>id</code>和<code>package name</code>用<code>radare</code>连接<code>frida</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r2 frida://c0e668cc/com.xingin.xhs </span><br></pre></td></tr></table></figure>
<p>然后你会得到一个r2dare的交互模式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">❯ r2 frida:<span class="comment">//c0e668cc/com.xingin.xhs</span></span><br><span class="line">WARNING: r_bin_open_buf: assertion <span class="string">&#x27;(st64)opt-&gt;sz &gt;= 0&#x27;</span> failed (line <span class="number">250</span>)</span><br><span class="line"> -- SSAbotage <span class="keyword">from</span> ISIL</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; </span><br></pre></td></tr></table></figure>

<h2 id="0x2-使用"><a href="#0x2-使用" class="headerlink" title="0x2 使用"></a>0x2 使用</h2><h4 id="0x2-1-gt-help"><a href="#0x2-1-gt-help" class="headerlink" title="0x2.1&gt; help"></a>0x2.1&gt; help</h4><p>首先介绍怎么使用<code>help</code>；对了，要使用<code>r2frida</code>的命令，得在命令的前面加上 <code>\</code> 或 <code>=!</code>；比如获取<code>help</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># =!? or \?</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; =!?</span><br><span class="line">r2frida commands available via =! or \ prefix</span><br><span class="line">. script                   Run script</span><br><span class="line">  frida-expression         Run given expression inside the agent</span><br><span class="line">/[x][j] &lt;string|hexpairs&gt;  Search hex/string pattern <span class="keyword">in</span> memory ranges (see search.in=?)</span><br><span class="line">/v[<span class="number">1248</span>][j] value          Search <span class="keyword">for</span> a value honoring <span class="string">`e cfg.bigendian`</span> <span class="keyword">of</span> given width</span><br><span class="line">/w[j] string               Search wide string</span><br><span class="line">&lt;space&gt; code..             Evaluate Cycript code</span><br><span class="line">?                          Show <span class="built_in">this</span> help</span><br><span class="line">?V                         Show target Frida version</span><br><span class="line">chcon file                 Change SELinux context (dl might <span class="built_in">require</span> <span class="built_in">this</span>)</span><br><span class="line">d.                         Start the chrome tools <span class="keyword">debugger</span></span><br><span class="line">db (&lt;addr&gt;|&lt;sym&gt;)          List or place breakpoint</span><br><span class="line">db- (&lt;addr&gt;|&lt;sym&gt;)|*       Remove breakpoint(s)</span><br><span class="line">dc                         Continue breakpoints or resume a spawned process</span><br><span class="line">dd[j-][fd] ([newfd])       List, dup2 or close filedescriptors (ddj <span class="keyword">for</span> <span class="built_in">JSON</span>)</span><br><span class="line">di[<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>] [addr]          Intercept and replace <span class="keyword">return</span> value <span class="keyword">of</span> address</span><br><span class="line">dk ([pid]) [sig]           Send specific signal to specific pid <span class="keyword">in</span> the remote system</span><br><span class="line">dkr                        Print the crash report (<span class="keyword">if</span> the app has crashed)</span><br><span class="line">dl libname                 Dlopen a library (Android see chcon)</span><br><span class="line">dl2 libname [main]         Inject library using Frida<span class="string">&#x27;s &gt;= 8.2 new API</span></span><br><span class="line"><span class="string">dm[.|j|*]                  Show memory regions</span></span><br><span class="line"><span class="string">dma &lt;size&gt;                 Allocate &lt;size&gt; bytes on the heap, address is returned</span></span><br><span class="line"><span class="string">... 有点长</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这是获取所有命令的帮助，如果想要获取某个字母有哪些命令只需要在其后面加 <code>?</code> 即可</p>
</blockquote>
<p>例如我想知道<code>i</code>字母开头的有哪些命令，都是干嘛的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \i?</span><br><span class="line"> i	dump info</span><br><span class="line"> i*	dump info r2</span><br><span class="line"> iAE	list all <span class="built_in">exports</span></span><br><span class="line"> iAE*	list all <span class="built_in">exports</span> r2</span><br><span class="line"> iAEj	list all <span class="built_in">exports</span> json</span><br><span class="line"> iAn	list all classes natives</span><br><span class="line"> iAs	list all symbols</span><br><span class="line"> iAs*	list all symbols r2</span><br><span class="line"> iAsj	list all symbols json</span><br><span class="line"> iE	list <span class="built_in">exports</span></span><br><span class="line"> iE*	list <span class="built_in">exports</span> r2</span><br><span class="line"> iE.	lookup symbol here</span><br><span class="line"> iEa	lookup <span class="keyword">export</span></span><br><span class="line"> iEa*	lookup <span class="keyword">export</span> r2</span><br><span class="line"> ...</span><br></pre></td></tr></table></figure>


<h4 id="0x2-2-gt-dm"><a href="#0x2-2-gt-dm" class="headerlink" title="0x2.2&gt; dm"></a>0x2.2&gt; dm</h4><p>简单介绍下常用命令。首先是获取so的信息命令 **<code>dm</code>**，比如地址。这里用到的<code>匹配符~</code>，这个符号类似grep命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dm~shield</span><br><span class="line"><span class="number">0xc5a1a000</span> - <span class="number">0xc5a95000</span> r-x /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==<span class="regexp">/lib/</span>arm/libshield.so</span><br><span class="line"><span class="number">0xc5a95000</span> - <span class="number">0xc5a99000</span> r-- <span class="regexp">/data/</span>app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==<span class="regexp">/lib/</span>arm/libshield.so</span><br><span class="line"><span class="number">0xc5a99000</span> - <span class="number">0xc5a9a000</span> rw- <span class="regexp">/data/</span>app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==<span class="regexp">/lib/</span>arm/libshield.so</span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p>你也可以以radare的格式输出，只需要在命令后面加个 <strong><code>*</code></strong> 符号</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dm*~shield</span><br><span class="line">f map.0xc5a1a000 = 0xc5a1a000 # r-x /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">f map.0xc5a95000 = 0xc5a95000 # r-- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br><span class="line">f map.0xc5a99000 = 0xc5a99000 # rw- /data/app/com.xingin.xhs-9gUqbwWzalUnAgU88apeTQ==/lib/arm/libshield.so</span><br></pre></td></tr></table></figure>
<p>然后呢，如果你想更方便的把获取到的数据直接使用，可以输出为json格式，只需要在命令后面加<code>j</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dmj~shield</span><br><span class="line">Do you want to print <span class="number">1</span> lines? (y/N) y</span><br><span class="line">[&#123;<span class="string">&quot;base&quot;</span>:<span class="string">&quot;0x12c00000&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">3145728</span>,<span class="string">&quot;protection&quot;</span>:<span class="string">&quot;rw-&quot;</span>,<span class="string">&quot;file&quot;</span>:&#123;<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/dev/ashmem/dalvik-main space (region space) (deleted)&quot;</span>,<span class="string">&quot;offset&quot;</span>:<span class="number">0</span>,<span class="string">&quot;size&quot;</span>:<span class="number">0</span>&#125;&#125;,&#123;<span class="string">&quot;base&quot;</span>:<span class="string">&quot;0x12f00000&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">4456448</span>,<span class="string">&quot;protection&quot;</span>:<span class="string">&quot;---&quot;</span>,<span class="string">&quot;file&quot;</span>:&#123;<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/dev/ashmem/dalvik-main space (region space) (deleted)&quot;</span>,<span class="string">&quot;offset&quot;</span>:<span class="number">3145728</span>,<span class="string">&quot;size&quot;</span>:<span class="number">0</span>&#125;&#125;,&#123;<span class="string">&quot;base&quot;</span>:<span class="string">&quot;0x13340000&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">262144</span>,<span class="string">&quot;protection&quot;</span>:<span class="string">&quot;rw-&quot;</span>,<span class="string">&quot;file&quot;</span>:&#123;<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/dev/ashmem/dalvik-main space (region space) (deleted)&quot;</span>,<span class="string">&quot;offset&quot;</span>:<span class="number">7602176</span>,<span class="string">&quot;size&quot;</span>:<span class="number">0</span>&#125;&#125;,&#123;<span class="string">&quot;base&quot;</span>:<span class="string">&quot;0x13380000&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">262144</span>,<span class="string">&quot;protection&quot;</span>:<span class="string">&quot;---&quot;</span>,<span class="string">&quot;file&quot;</span>:&#123;<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/dev/ashmem/dalvik-main space (region space) (deleted)&quot;</span>,...</span><br></pre></td></tr></table></figure>


<h4 id="0x2-3-gt-iE"><a href="#0x2-3-gt-iE" class="headerlink" title="0x2.3&gt; iE"></a>0x2.3&gt; iE</h4><p>然后是获取so文件的所有导出函数命令 **<code>iE</code>**，应该是 <code>info exports</code> （我猜的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \iE* libshield.so</span><br><span class="line">f sym.fun._Znaj = <span class="number">0xc5a3f8b5</span></span><br><span class="line">f sym.fun._ZdaPv = <span class="number">0xc5a3e579</span></span><br><span class="line">f sym.fun._ZdlPv = <span class="number">0xc5a3e575</span></span><br><span class="line">f sym.fun.__cxa_begin_catch = <span class="number">0xc5a3ebd5</span></span><br><span class="line">f sym.fun._ZSt9terminatev = <span class="number">0xc5a3f4bd</span></span><br><span class="line">f sym.fun._Znwj = <span class="number">0xc5a3f861</span></span><br><span class="line">f sym.var._ZTVN10__cxxabiv117__class_type_infoE = <span class="number">0xc5a97290</span></span><br><span class="line">f sym.fun.JNI_OnLoad = <span class="number">0xc5a257a9</span></span><br><span class="line">f sym.fun.__cxa_allocate_exception = <span class="number">0xc5a3e655</span></span><br><span class="line">f sym.fun.__cxa_throw = <span class="number">0xc5a3f571</span></span><br><span class="line">f sym.fun.__cxa_free_exception = <span class="number">0xc5a3e6fd</span></span><br><span class="line">f sym.fun.__cxa_rethrow = <span class="number">0xc5a3f5f1</span></span><br><span class="line">f sym.fun.__cxa_end_catch = <span class="number">0xc5a3ec65</span></span><br><span class="line">f sym.var._ZSt7nothrow = <span class="number">0xc5a94138</span></span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE5clearEv = <span class="number">0xc5a36c99</span></span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE16_M_insert_uniqueISsEESt4pairISt17_Rb_tree_iteratorISsEbEOT_ = <span class="number">0xc5a36d3d</span></span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEE4findERKSs = <span class="number">0xc5a38701</span></span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEED2Ev = <span class="number">0xc5a2df71</span></span><br><span class="line">f sym.fun._ZNSt8_Rb_treeISsSsSt9_IdentityISsESt4lessISsESaISsEED2Ev = <span class="number">0xc5a36f11</span></span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEE7reserveEj = <span class="number">0xc5a32455</span></span><br><span class="line">f sym.fun._ZNSt6vectorISsSaISsEE19_M_emplace_back_auxIJSsEEEvDpOT_ = <span class="number">0xc5a39361</span></span><br><span class="line">f sym.fun.__cxa_guard_acquire = <span class="number">0xc5a3f665</span></span><br><span class="line">f sym.fun.__cxa_guard_release = <span class="number">0xc5a3f7dd</span></span><br><span class="line">f sym.fun._ZNSt9exceptionD2Ev = <span class="number">0xc5a3ed01</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="0x-24-gt"><a href="#0x-24-gt" class="headerlink" title="0x.24&gt; \/"></a>0x.24&gt; \/</h4><p>搜索内存中的数据 **<code>\/</code>**；首先看看help</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \?~^/</span><br><span class="line">/[x][j] &lt;string|hexpairs&gt;  Search hex/string pattern <span class="keyword">in</span> memory ranges (see search.in=?)</span><br><span class="line">/v[<span class="number">1248</span>][j] value          Search <span class="keyword">for</span> a value honoring <span class="string">`e cfg.bigendian`</span> <span class="keyword">of</span> given width</span><br><span class="line">/w[j] string               Search wide string</span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>基础使用方法：<strong>\/ keyword</strong></p>
</blockquote>
<p>比如我要搜索…..emmmmmm：**<code>TracerPid</code>**；首先是一顿输出，然后会出现找到的个数，比如这里的12个，然后对应着地址和内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \/ TracerPid</span><br><span class="line">Searching <span class="number">9</span> bytes: <span class="number">54</span> <span class="number">72</span> <span class="number">61</span> <span class="number">63</span> <span class="number">65</span> <span class="number">72</span> <span class="number">50</span> <span class="number">69</span> <span class="number">64</span></span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x12c00000</span>-<span class="number">0x15180000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x151c0000</span>-<span class="number">0x155c0000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x15640000</span>-<span class="number">0x15680000</span>]</span><br><span class="line">...</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0xff508000</span>-<span class="number">0xffd07000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0xffff0000</span>-<span class="number">0xffff1000</span>]</span><br><span class="line">hits: <span class="number">12</span></span><br><span class="line"><span class="number">0x14626d48</span> hit0_0 TracerPid:</span><br><span class="line"><span class="number">0xab1108f4</span> hit0_1 TracerPid:</span><br><span class="line"><span class="number">0xc2972232</span> hit0_2 TracerPid:</span><br><span class="line"><span class="number">0xc4c1e76c</span> hit0_3 TracerPid</span><br><span class="line"><span class="number">0xc5aa7810</span> hit0_4 TracerPid:<span class="number">0</span></span><br><span class="line"><span class="number">0xc5ab2da8</span> hit0_5 TracerPid</span><br><span class="line"><span class="number">0xc8eb9c5e</span> hit0_6 TracerPid:0Uid:10185101851018510185Gid:<span class="number">10185101851</span></span><br><span class="line"><span class="number">0xcb15818c</span> hit0_7 TracerPid:</span><br><span class="line"><span class="number">0xd21ff45e</span> hit0_8 TracerPid:0Uid:10185101851018510185Gid:<span class="number">10185101851</span></span><br><span class="line"><span class="number">0xd21ff85e</span> hit0_9 TracerPid:0Uid:10185101851018510185Gid:<span class="number">10185101851</span></span><br><span class="line"><span class="number">0xd277b892</span> hit0_10 TracerPid:</span><br><span class="line"><span class="number">0xdf57105d</span> hit0_11 TracerPid:0Uid:10185101851018510185Gid:<span class="number">10185101851</span></span><br><span class="line"></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p>为了验证我刚刚所说的，直接看内存，正好可以教用一个字母看内存数据，这个命令是radare的命令，这就是交互的好处。为了更好的凸显数据，我选择的是比较长的那个字符串，地址是：<code>0xc8eb9c5e</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; x @ <span class="number">0xc8eb9c5e</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xc8eb9c5e</span>  <span class="number">5472</span> <span class="number">6163</span> <span class="number">6572</span> <span class="number">5069</span> 643a <span class="number">0930</span> 0a55 <span class="number">6964</span>  TracerPid:<span class="number">.0</span>.Uid</span><br><span class="line"><span class="number">0xc8eb9c6e</span>  3a09 <span class="number">3130</span> <span class="number">3138</span> <span class="number">3509</span> <span class="number">3130</span> <span class="number">3138</span> <span class="number">3509</span> <span class="number">3130</span>  :<span class="number">.10185</span><span class="number">.10185</span><span class="number">.10</span></span><br><span class="line"><span class="number">0xc8eb9c7e</span>  <span class="number">3138</span> <span class="number">3509</span> <span class="number">3130</span> <span class="number">3138</span> 350a <span class="number">4769</span> 643a <span class="number">0931</span>  <span class="number">185.10185</span>.Gid:<span class="number">.1</span></span><br><span class="line"><span class="number">0xc8eb9c8e</span>  <span class="number">3031</span> <span class="number">3835</span> <span class="number">0931</span> <span class="number">3031</span> <span class="number">3835</span> <span class="number">0931</span> <span class="number">3031</span> <span class="number">3835</span>  <span class="number">0185.10185</span><span class="number">.10185</span></span><br><span class="line"><span class="number">0xc8eb9c9e</span>  <span class="number">0931</span> <span class="number">3031</span> <span class="number">3835</span> 0a46 <span class="number">4453</span> 697a 653a <span class="number">0935</span>  <span class="number">.10185</span>.FDSize:<span class="number">.5</span></span><br><span class="line"><span class="number">0xc8eb9cae</span>  <span class="number">3132</span> 0a47 726f <span class="number">7570</span> 733a <span class="number">0933</span> <span class="number">3030</span> <span class="number">3320</span>  <span class="number">12.</span>Groups:<span class="number">.3003</span></span><br><span class="line"><span class="number">0xc8eb9cbe</span>  <span class="number">3939</span> <span class="number">3937</span> <span class="number">2032</span> <span class="number">3031</span> <span class="number">3835</span> <span class="number">2035</span> <span class="number">3031</span> <span class="number">3835</span>  <span class="number">9997</span> <span class="number">20185</span> <span class="number">50185</span></span><br><span class="line"><span class="number">0xc8eb9cce</span>  <span class="number">2039</span> <span class="number">3939</span> <span class="number">3039</span> <span class="number">3939</span> <span class="number">3720</span> 0a56 6d50 <span class="number">6561</span>   <span class="number">99909997</span> .VmPea</span><br><span class="line"><span class="number">0xc8eb9cde</span>  6b3a <span class="number">0920</span> <span class="number">3234</span> <span class="number">3131</span> <span class="number">3832</span> <span class="number">3020</span> 6b42 0a56  k:. <span class="number">2411820</span> kB.V</span><br><span class="line"><span class="number">0xc8eb9cee</span>  6d53 697a 653a <span class="number">0920</span> <span class="number">3233</span> <span class="number">3439</span> <span class="number">3730</span> <span class="number">3820</span>  mSize:. <span class="number">2349708</span></span><br><span class="line"><span class="number">0xc8eb9cfe</span>  6b42 0a56 6d4c 636b 3a09 <span class="number">2020</span> <span class="number">2020</span> <span class="number">2031</span>  kB.VmLck:.     <span class="number">1</span></span><br><span class="line"><span class="number">0xc8eb9d0e</span>  <span class="number">3136</span> 206b 420a 566d <span class="number">5069</span> 6e3a <span class="number">0920</span> <span class="number">2020</span>  <span class="number">16</span> kB.VmPin:.</span><br><span class="line"><span class="number">0xc8eb9d1e</span>  <span class="number">2020</span> <span class="number">2020</span> <span class="number">3020</span> 6b42 0a56 6d48 574d 3a09      <span class="number">0</span> kB.VmHWM:.</span><br><span class="line"><span class="number">0xc8eb9d2e</span>  <span class="number">2020</span> <span class="number">3637</span> <span class="number">3539</span> <span class="number">3336</span> 206b 420a 566d <span class="number">5253</span>    <span class="number">675936</span> kB.VmRS</span><br><span class="line"><span class="number">0xc8eb9d3e</span>  533a <span class="number">0920</span> <span class="number">2035</span> <span class="number">3636</span> <span class="number">3431</span> <span class="number">3620</span> 6b42 0a52  S:.  <span class="number">566416</span> kB.R</span><br><span class="line"><span class="number">0xc8eb9d4e</span>  <span class="number">7373</span> 416e 6f6e 3a09 <span class="number">2020</span> <span class="number">3130</span> <span class="number">3630</span> <span class="number">3136</span>  ssAnon:.  <span class="number">106016</span></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p><code>x</code> 是 <code>px</code> 命令的简写，这个命令作用是<code>show hexdump</code>。从上面可以明确的看到字符串；还可以用<code>ps</code> 命令直接输出pretty的字符串，当然得事先知道指定的地址内容存的是字符串，不然返回的就不知道是一堆啥玩意儿了，使用方法和<code>px</code>差不多</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; ps @ <span class="number">0xc8eb9c5e</span></span><br><span class="line">TracerPid:\x090</span><br><span class="line">Uid:\x0910185\x0910185\x0910185\x0910185</span><br><span class="line">Gid:\x0910185\x0910185\x0910185\x0910185</span><br><span class="line">FDSize:\x09512</span><br><span class="line">Groups:\x093003 <span class="number">9997</span> <span class="number">20185</span> <span class="number">50185</span> <span class="number">99909997</span></span><br><span class="line">VmPeak:\x09 <span class="number">2411820</span> kB</span><br><span class="line">VmSize:\x09 <span class="number">2358724</span> kB</span><br><span class="line">VmLck:\x09     <span class="number">116</span> kB</span><br><span class="line">VmPin:\x09       <span class="number">0</span> kB</span><br><span class="line">VmHWM:\x09  <span class="number">675936</span> kB</span><br><span class="line">VmRSS:\x09  <span class="number">522464</span> kB</span><br><span class="line">RssAnon:\x09  <span class="number">100820</span></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p>这里用json格式输出就很舒服了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; psj @ <span class="number">0xc8eb9c5e</span></span><br><span class="line">&#123;<span class="string">&quot;string&quot;</span>:<span class="string">&quot;TracerPid:\u00090\u000aUid:\u000910185\u000910185\u000910185\u000910185\u000aGid:\u000910185\u000910185\u000910185\u000910185\u000aFDSize:\u0009512\u000aGroups:\u00093003 9997 20185 50185 99909997 \u000aVmPeak:\u0009 2411820 kB\u000aVmSize:\u0009 2253264 kB\u000aVmLck:\u0009     116 kB\u000aVmPin:\u0009       0 kB\u000aVmHWM:\u0009  675936 kB\u000aVmRSS:\u0009   84988 kB\u000aRssAnon:\u0009       0&quot;</span>,<span class="string">&quot;offset&quot;</span>:<span class="number">3370884190</span>,<span class="string">&quot;section&quot;</span>:<span class="string">&quot;unknown&quot;</span>,<span class="string">&quot;length&quot;</span>:<span class="number">256</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;ascii&quot;</span>&#125;</span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>

<p>搜索也可以指定搜索的数据类型以及输出的格式，比如以十六进制搜索输出json格式的结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \/xj <span class="number">547261636572506964</span></span><br><span class="line">Searching <span class="number">9</span> bytes: <span class="number">54</span> <span class="number">72</span> <span class="number">61</span> <span class="number">63</span> <span class="number">65</span> <span class="number">72</span> <span class="number">50</span> <span class="number">69</span> <span class="number">64</span></span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x12c00000</span>-<span class="number">0x12d80000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x12f80000</span>-<span class="number">0x12fc0000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x13000000</span>-<span class="number">0x13040000</span>]</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0x13340000</span>-<span class="number">0x13380000</span>]</span><br><span class="line">...</span><br><span class="line">Searching <span class="number">9</span> bytes <span class="keyword">in</span> [<span class="number">0xffff0000</span>-<span class="number">0xffff1000</span>]</span><br><span class="line">hits: <span class="number">12</span></span><br><span class="line">[&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0x13033778&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_0&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xab1108f4&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_1&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xc2972232&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_2&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xc4c1e76c&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_3&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xc5aa7810&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_4&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xc5ab2da8&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_5&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xc8eb9c5e&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_6&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xcb15818c&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_7&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xd21ff45e&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_8&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xd21ff85e&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_9&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xd277b892&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_10&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;,&#123;<span class="string">&quot;address&quot;</span>:<span class="string">&quot;0xdf57105d&quot;</span>,<span class="string">&quot;size&quot;</span>:<span class="number">9</span>,<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;hit2_11&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;547261636572506964&quot;</span>&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="0x3-Dynamic"><a href="#0x3-Dynamic" class="headerlink" title="0x3 Dynamic"></a>0x3 Dynamic</h2><p>这个功能特别牛逼，啊不，应该说<code>radare+frida</code>在这方法特别牛逼，所以我要单独拿出来做一个大块说。</p>
<p>首先看help</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \d?</span><br><span class="line"> db	breakpoint</span><br><span class="line"> db-	breakpoint unset</span><br><span class="line"> dbj	breakpoint json</span><br><span class="line"> dc	breakpoint <span class="keyword">continue</span></span><br><span class="line"> dcu	breakpoint <span class="keyword">continue</span> until</span><br><span class="line"> dd	list file descriptors</span><br><span class="line"> dd-	close file descriptors</span><br><span class="line"> ddj	list file descriptors json</span><br><span class="line"> di	intercept help</span><br><span class="line"> di-<span class="number">1</span>	intercept ret_1</span><br><span class="line"> di0	intercept ret0</span><br><span class="line"> di1	intercept ret1</span><br><span class="line"> dis	intercept ret string</span><br><span class="line"> dk	send signal</span><br><span class="line"> dl	dlopen</span><br><span class="line"> dm	list memory ranges</span><br><span class="line"> dm*	list memory ranges r2</span><br><span class="line"> dm.	list memory ranges here</span><br><span class="line"> dma	alloc size</span><br><span class="line"> dma-	remove alloc</span><br><span class="line"> dmad	alloc dup</span><br><span class="line"> dmal	list allocs</span><br><span class="line"> dmas	alloc string</span><br><span class="line"> dmh	list malloc ranges</span><br><span class="line"> dmh*	list malloc ranges r2</span><br><span class="line"> dmhj	list malloc ranges json</span><br><span class="line"> dmhm	list malloc maps</span><br><span class="line"> dmj	list memory ranges json</span><br><span class="line"> dmm	list memory maps</span><br><span class="line"> dmm.	list memory ranges here</span><br><span class="line"> dmp	change memory protection</span><br><span class="line"> dp	get pid</span><br><span class="line"> dpj	get pid json</span><br><span class="line"> dpt	list threads</span><br><span class="line"> dptj	list threads json</span><br><span class="line"> dr	dump registers</span><br><span class="line"> dr*	dump registers r2</span><br><span class="line"> dr8	dump register arena</span><br><span class="line"> drj	dump registers json</span><br><span class="line"> drp	dump register profile</span><br><span class="line"> drr	dump registers recursively</span><br><span class="line"> dt	trace</span><br><span class="line"> dt*	trace r2</span><br><span class="line"> dt-	clear trace</span><br><span class="line"> dt-*	clear all trace</span><br><span class="line"> dt.	trace here</span><br><span class="line"> dtf	trace format</span><br><span class="line"> dth	trace hook</span><br><span class="line"> dtj	trace json</span><br><span class="line"> dtl	trace log dump</span><br><span class="line"> dtl*	trace log dump r2</span><br><span class="line"> dtl-	trace log clear</span><br><span class="line"> dtl-*	trace log clear all</span><br><span class="line"> dtlj	trace log dump json</span><br><span class="line"> dtlq	trace log dump quiet</span><br><span class="line"> dtq	trace quiet</span><br><span class="line"> dtr	trace regs</span><br><span class="line"> dts	stalk trace everything</span><br><span class="line"> dts*	stalk trace everything r2</span><br><span class="line"> dts?	stalk trace everything help</span><br><span class="line"> dtsf	stalk trace <span class="function"><span class="keyword">function</span></span></span><br><span class="line"><span class="function"> <span class="title">dtsf</span>*	<span class="title">stalk</span> <span class="title">trace</span> <span class="function"><span class="keyword">function</span> <span class="title">r2</span></span></span></span><br><span class="line"><span class="function"><span class="function"> <span class="title">dtsfj</span>	<span class="title">stalk</span> <span class="title">trace</span> <span class="function"><span class="keyword">function</span> <span class="title">json</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"> <span class="title">dtsj</span>	<span class="title">stalk</span> <span class="title">trace</span> <span class="title">everything</span> <span class="title">json</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"> <span class="title">dxc</span>	<span class="title">dx</span> <span class="title">call</span></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function"></span></span></span></span><br><span class="line"><span class="function"><span class="function"><span class="function">[0<span class="title">x00000000</span>]&gt;</span></span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>我挑几个我用的最频繁的命令，因为是在太多了。。。**<code>dm</code>** 上面已经用过了就不说了</p>
</blockquote>
<p>说一下和 <strong><code>dm</code></strong> 在字母个数方面差不了多少的命令 **<code>dma</code>**，这个命令是分配内存大小用的。可以看它的详细help</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dma?</span><br><span class="line"> dma	alloc size</span><br><span class="line"> dma-	remove alloc</span><br><span class="line"> dmad	alloc dup</span><br><span class="line"> dmal	list allocs</span><br><span class="line"> dmas	alloc string</span><br><span class="line"></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong><code>dma</code></strong> 分配内存大小 <br><strong><code>dma-</code></strong> 删除所有分配的内存 <br><strong><code>dmad</code></strong> … 没用过，翻译是重复分配 <br><strong><code>dmal</code></strong> 列出所有分配的内存的地址 <br><strong><code>dmas</code></strong> 分配字符串</p>
</blockquote>
<h4 id="0x3-1-gt-dma"><a href="#0x3-1-gt-dma" class="headerlink" title="0x3.1&gt; dma"></a>0x3.1&gt; dma</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dma <span class="number">10</span></span><br><span class="line"><span class="number">0xc09622b8</span></span><br><span class="line">[<span class="number">0x00000000</span>]&gt; x @ <span class="number">0xc09622b8</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xc09622b8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> c300 <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc09622c8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc09622d8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc09622e8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc09622f8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962308</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962318</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962328</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962338</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962348</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962358</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962368</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962378</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> d901 <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xc0962388</span>  d0dd 4ed1 <span class="number">9873</span> 95c0 102c dbc3 e0e1 4ed1  ..N..s...,....N.</span><br><span class="line"><span class="number">0xc0962398</span>  3c01 afc5 <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  &lt;...............</span><br><span class="line"><span class="number">0xc09623a8</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p>分配字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dmas hellworld</span><br><span class="line"><span class="number">0xc3db1648</span></span><br><span class="line">[<span class="number">0x00000000</span>]&gt; ps @ <span class="number">0xc3db1648</span></span><br><span class="line">hellworld</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; x @ <span class="number">0xc3db1648</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xc3db1648</span>  <span class="number">6865</span> 6c6c 776f 726c <span class="number">6400</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span>  hellworld.......</span><br><span class="line"><span class="number">0xc3db1658</span>  <span class="number">6847</span> e7da 000d 2f0e <span class="number">5016</span> dbc3 1b00 <span class="number">0000</span>  hG..../.P.......</span><br><span class="line"><span class="number">0xc3db1668</span>  <span class="number">7847</span> e7da 580b a702 <span class="number">0100</span> <span class="number">0000</span> <span class="number">9801</span> 0d34  xG..X.........<span class="number">.4</span></span><br><span class="line"><span class="number">0xc3db1678</span>  <span class="number">1800</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span> 3ce8 dfb6 <span class="number">7465</span> <span class="number">7200</span>  ........&lt;...ter.</span><br><span class="line"><span class="number">0xc3db1688</span>  <span class="number">6500</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span> 10f8 e6da <span class="number">7465</span> <span class="number">7200</span>  e...........ter.</span><br><span class="line"><span class="number">0xc3db1698</span>  246f dab6 <span class="number">1300</span> <span class="number">0000</span> 3ce8 dfb6 3ce8 dfb6  $o......&lt;...&lt;...</span><br><span class="line"><span class="number">0xc3db16a8</span>  <span class="number">6500</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span> 20f8 e6da <span class="number">7465</span> <span class="number">7200</span>  e....... ...ter.</span><br><span class="line"><span class="number">0xc3db16b8</span>  246f dab6 <span class="number">1300</span> <span class="number">0000</span> 30f8 e6da <span class="number">7465</span> <span class="number">7200</span>  $o.....<span class="number">.0</span>...ter.</span><br><span class="line">0xc3db16c8  6500 0000 2300 0000 4817 dbc3 e186 1a17  e...#...H.......</span><br><span class="line"><span class="number">0xc3db16d8</span>  <span class="number">0937</span> d4b8 <span class="number">3092</span> e3c3 <span class="number">0001</span> <span class="number">0000</span> <span class="number">3092</span> e3c3  <span class="number">.7</span>.<span class="number">.0</span>......<span class="number">.0</span>...</span><br><span class="line"><span class="number">0xc3db16e8</span>  <span class="number">0080</span> 45c1 <span class="number">1300</span> <span class="number">0000</span> d888 1fb7 <span class="number">0000</span> <span class="number">0000</span>  ..E.............</span><br><span class="line"><span class="number">0xc3db16f8</span>  <span class="number">1000</span> <span class="number">0000</span> <span class="number">1300</span> <span class="number">0000</span> 3ce8 dfb6 3ce8 dfb6  ........&lt;...&lt;...</span><br><span class="line"><span class="number">0xc3db1708</span>  <span class="number">6500</span> 000f <span class="number">1300</span> <span class="number">0000</span> 50f8 e6da <span class="number">7465</span> <span class="number">7200</span>  e.......P...ter.</span><br><span class="line"><span class="number">0xc3db1718</span>  <span class="number">8403</span> <span class="number">2900</span> 1b00 <span class="number">0000</span> 3ce8 dfb6 3ce8 dfb6  ..).....&lt;...&lt;...</span><br><span class="line"><span class="number">0xc3db1728</span>  3ce8 dfb6 3ce8 dfb6 f01c fbc2 <span class="number">1300</span> <span class="number">0000</span>  &lt;...&lt;...........</span><br><span class="line"><span class="number">0xc3db1738</span>  60f8 e6da <span class="number">7465</span> <span class="number">7200</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">2300</span> <span class="number">0000</span>  <span class="string">`...ter.....#...</span></span><br><span class="line"><span class="string">[0x00000000]&gt;</span></span><br></pre></td></tr></table></figure>
<p>列出所有已分配内存地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; clear</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; \dmal</span><br><span class="line"><span class="number">0xc09622b8</span>	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0xc3db1648</span>	<span class="string">&quot;hellworld&quot;</span></span><br><span class="line"></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>
<p>删除所有</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dma-</span><br><span class="line"></span><br><span class="line">[<span class="number">0x00000000</span>]&gt; \dmal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="number">0x00000000</span>]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-gt-dtf-trace-function-from-address"><a href="#3-2-gt-dtf-trace-function-from-address" class="headerlink" title="3.2&gt; dtf (trace function from address)"></a>3.2&gt; dtf (trace function from address)</h3><p>例子中，<code>pp</code> 是方法的参数个数和类型；<code>^</code>表示<code>onEnter</code>还是<code>onExit</code>，和<code>Interceptor.attach</code> 的回调一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dtf <span class="number">0xd0c4a143</span> pp^</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="string">&quot; 1: 0x1155f251)RACE] dt0xedb88eb9d0c4a1libart.so0: &quot;</span><span class="number">0</span>��<span class="number">0xb9eb9</span>�<span class="number">0</span></span><br><span class="line">        <span class="number">0xd0c4a54d</span>      libwbutil.so    <span class="number">0x454d</span></span><br><span class="line">        <span class="number">0xd0c49d65</span>      libwbutil.so    Java_com_sina_weibo_WeiboApplication_newCalculateS+<span class="number">0x64</span></span><br><span class="line">        <span class="number">0xd1130b25</span>      base.odex       <span class="number">0xf9b25</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot; 1: 0x1155f251)0xd0c4a10xedb88eb9: &quot;</span><span class="number">0</span>��libart.so       <span class="number">0xb9eb9</span></span><br><span class="line">        <span class="number">0xd0c4a54d</span>      libwbutil.so    <span class="number">0x454d</span></span><br><span class="line">        <span class="number">0xd0c49d65</span>      libwbutil.so    Java_com_sina_weibo_WeiboApplication_newCalculateS+<span class="number">0x64</span></span><br><span class="line">        <span class="number">0xd1130b25</span>      base.odex       <span class="number">0xf9b25</span></span><br></pre></td></tr></table></figure>


<p>… 其他的命令等有空在补充吧，或者自己学习</p>
<h1 id="0x4-Memory"><a href="#0x4-Memory" class="headerlink" title="0x4 Memory"></a>0x4 Memory</h1><p>以Share Weibo为例，<strong>改写</strong>内存数据，是改写，不是写入。</p>
<p>首先获取基址</p>
<p><code>\dm~wbutil</code> 中的 <code>~</code> 是通配符，如果你不太记得so的文件全名就可以用这个来匹配。</p>
<p>其中有 <code>读和执行</code> 权限的那条中的第一个地址 <code>0xcdddc000</code> 是我们要的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dm~wbutil</span><br><span class="line"><span class="number">0xcdddc000</span> - <span class="number">0xcdde8000</span> r-x /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line"><span class="number">0xcdde8000</span> - <span class="number">0xcdde9000</span> r-- <span class="regexp">/data/</span>app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line"><span class="number">0xcdde9000</span> - <span class="number">0xcddea000</span> rw- <span class="regexp">/data/</span>app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; </span><br></pre></td></tr></table></figure>
<p>先说下目标；</p>
<blockquote>
<p>需要在 native 方法 <code>newCalculateS</code> 中找到计算出加密字符串 <code>s</code> 的算法</p>
<p>经过分析，在<code>Java_com_sina_weibo_WeiboApplication_newCalculate</code>方法里中的最后是返回的<code>newCalculateS</code>方法；</p>
<p>其中参数1是<code>env指针</code>，参数2是<code>WeiboApplication对象</code>，参数3是<code>uid</code>。</p>
</blockquote>
<p>不过其中还有一大块代码看似没有用到。</p>
<blockquote>
<p>首先是判断0xd0c4有没有数据，这是一个字符串，char*类型。</p>
<p>然后判断0xd0c8，这是一个char。</p>
</blockquote>
<p>下面的方法看了下有点复制，先看 <code>newCalculateS</code> 方法逻辑吧</p>
<p><img src="images/ida_pro_java_newCalculateS_01.png"></p>
<p>这个方法全貌如图</p>
<p><img src="images/ida_pro_newCalculateS.png"></p>
<p>整体逻辑是：</p>
<blockquote>
<p>1、通过调用<code>getOriginalString</code>用<code>uid</code>获取<code>key1</code></p>
<p>2、然后通过<code>getKeyString</code>获取<code>key2</code></p>
<p>3、接着通过<code>getIndex</code>将<code>key2</code>处理，返回一个<code>jintArray</code>对象</p>
<p>4、然后通过这个<code>jintArray</code>对象从<code>key1</code>中获取对应索引的字符，并使用java的<code>StringBuilder</code>拼接成<code>jstring</code>对象</p>
</blockquote>
<h2 id="0x4-1-getOriginalString"><a href="#0x4-1-getOriginalString" class="headerlink" title="0x4.1 getOriginalString"></a>0x4.1 getOriginalString</h2><p>这个方法如图所示</p>
<p><img src="images/ida_pro_getOriginalString.png"></p>
<p>很简单的几行代码，难处在<code>g_pin</code>和<code>g_from</code>这两个变量；</p>
<p>可能刚打开到这个方法<code>CallObjectMethod</code>只有三个参数，并没有第四个参数；</p>
<p>这里就是拼接字符串，<code>g_pin + uid + g_from</code>；</p>
<p>我们需要找到g_pin和g_from，这里可以先用下面的代码hook一下看看是什么东西；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">&quot;libwbutil.so&quot;</span>, <span class="string">&quot;_ZN7_JNIEnv16CallObjectMethodEP8_jobjectP10_jmethodIDz&quot;</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> <span class="built_in">String</span> = Java.use(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">           <span class="keyword">var</span> ret = Java.cast(ptr(args[<span class="number">3</span>]), <span class="built_in">String</span>);</span><br><span class="line">           <span class="built_in">console</span>.warn(<span class="string">&quot;CallObjectMethod(&quot;</span>.concat(args[<span class="number">0</span>])</span><br><span class="line">                            + <span class="string">&quot;, &quot;</span>.concat(args[<span class="number">1</span>])</span><br><span class="line">                            + <span class="string">&quot;, &quot;</span>.concat(args[<span class="number">2</span>])</span><br><span class="line">                            + <span class="string">&quot;, &quot;</span>.concat(ret) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CallObjectMethod(<span class="number">0xccb76780</span>, <span class="number">0x119</span>, <span class="number">0x70dd9e70</span>, 5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo)</span><br><span class="line">CallObjectMethod(<span class="number">0xccb76780</span>, <span class="number">0x119</span>, <span class="number">0x70dd9e70</span>, 73586191xx)</span><br><span class="line">CallObjectMethod(<span class="number">0xccb76780</span>, <span class="number">0x119</span>, <span class="number">0x70dd9e70</span>, 109C0950xx)</span><br></pre></td></tr></table></figure>
<p>然后就是将拼接好的字符串进行<code>sha512</code>加密并返回</p>
<h2 id="0x4-2-getKeyString"><a href="#0x4-2-getKeyString" class="headerlink" title="0x4.2 getKeyString"></a>0x4.2 getKeyString</h2><p>反编译如下</p>
<p><img src="images/ida_pro_getKeyString.png"></p>
<p>这里只append了<code>g_from</code>，然后用<code>sha512</code>加密后返回</p>
<h2 id="0x4-3-getIndex"><a href="#0x4-3-getIndex" class="headerlink" title="0x4.3 getIndex"></a>0x4.3 getIndex</h2><p><img src="images/ida_pro_getIndex.png"></p>
<p>这里稍微复杂点的就是do while；前面是将十六进制的key2转为bytearray</p>
<p>在do while里</p>
<blockquote>
<p>1、首先从bytearray里取内容，索引是v10；然后将其转为int</p>
<p>2、然后将索引v10与转换后的byte相加，转而变成新索引</p>
<p>3、v9自增4</p>
<p>4、当v9 == 32结束while</p>
</blockquote>
<p>这里一共处理了8次，也就是最后的数据是长度为8</p>
<p>所以下面new了一个长度为8的int数组，然后把数据复制到里面，然后返回</p>
<h2 id="0x4-4-g-pin、g-from"><a href="#0x4-4-g-pin、g-from" class="headerlink" title="0x4.4 g_pin、g_from"></a>0x4.4 g_pin、g_from</h2><p>回到最初到哪个<code>newCalculateS</code>方法，这里有个 app_setPin 方法很可疑，而且它的第二参数和上面的那串字符串参数的方法有关。</p>
<p>这个方法就是把 a2 设置为 <code>g_pin</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">app_setPin</span><span class="params">(<span class="keyword">int</span> result, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !g_pin )</span><br><span class="line">  &#123;</span><br><span class="line">    result = _JNIEnv::<span class="built_in">NewGlobalRef</span>(result, a2);</span><br><span class="line">    g_pin = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而这个a2是sub_451C方法返回的内容经过new转为jstring的；所以只要解决这个方法就行了。</p>
<p>这个方法的第三个参数是十六进制字符串，不清楚是什么。我们可以hook看看返回值是什么</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sh</span>(<span class="params">a, s</span>)</span>&#123;<span class="built_in">console</span>.error(hexdump(ptr(<span class="built_in">String</span>(a)),&#123;<span class="attr">offset</span>:<span class="number">0</span>,<span class="attr">length</span>:s,<span class="attr">header</span>:<span class="literal">true</span>,<span class="attr">ansi</span>:<span class="literal">false</span>&#125;))&#125;</span><br><span class="line"><span class="keyword">var</span> base = Module.getBaseAddress(<span class="string">&quot;libwbutil.so&quot;</span>);</span><br><span class="line">Interceptor.attach(ptr(base.add(<span class="number">0x451c</span>+<span class="number">1</span>)), &#123;</span><br><span class="line">    onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        sh(retval, <span class="number">64</span>); <span class="comment">// hexdump</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>不出意外的话什么都没输出，应该是没调用。</p>
<p>首先看看最先判断的那个变量是什么玩意儿，这里用r2frida会特别方便；</p>
<p>先用dm命令获取基址，然后通过px命令获取内存十六进制输出；可以看到是个地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; \dm~wbutil</span><br><span class="line"><span class="number">0xcddd0000</span> - <span class="number">0xcdddc000</span> r-x /data/app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line"><span class="number">0xcdddc000</span> - <span class="number">0xcdddd000</span> r-- <span class="regexp">/data/</span>app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line"><span class="number">0xcdddd000</span> - <span class="number">0xcddde000</span> rw- <span class="regexp">/data/</span>app/com.hengye.share-xI074YHFAARyeqAB7fhP4w==<span class="regexp">/lib/</span>arm/libwbutil.so</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; px @ <span class="number">0xcddd0000</span>+<span class="number">0xd0c4</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xcdddd0c4</span>  70dc <span class="number">10e5</span> <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  p...............</span><br><span class="line"><span class="number">0xcdddd0d4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd0e4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd0f4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd104</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd114</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd124</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd134</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd144</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd154</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd164</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd174</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> c243 <span class="number">0000</span>  .............C..</span><br><span class="line"><span class="number">0xcdddd184</span>  a247 <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  .G..............</span><br><span class="line"><span class="number">0xcdddd194</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd1a4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line"><span class="number">0xcdddd1b4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; </span><br></pre></td></tr></table></figure>
<p>而这个地址的内容恰好是和上面的g_pin内容一样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; x @ <span class="number">0xe510dc70</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xe510dc70</span>  356c <span class="number">3057</span> 586e <span class="number">6869</span> <span class="number">5934</span> 704a <span class="number">3739</span> 344b  5l0WXnhiY4pJ794K</span><br><span class="line"><span class="number">0xe510dc80</span>  494a <span class="number">3752</span> <span class="number">7735</span> <span class="number">4634</span> <span class="number">3556</span> <span class="number">5867</span> <span class="number">3973</span> 6a6f  IJ7Rw5F45VXg9sjo</span><br></pre></td></tr></table></figure>
<blockquote>
<p>不过这个地址貌似一直都有东西，所以首个if会不成立，直接调用 <code>newCalculateS</code>；</p>
<p>这里可以尝试改指令，把指令直接改成BEQ，不过这样做会运行一会就闪退，所以这里我卡了一点时间，不过好在<code>radare2</code> 能改内存数据，而 <code>frida</code> 加上这个功能基本可以和 <code>ida</code> 刚了，我还觉得比ida好用。</p>
</blockquote>
<p>这里用r2的<code>wx</code>命令就能修改</p>
<p>help:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; wx?</span><br><span class="line">Usage: wx[f] [arg]  </span><br><span class="line">| wx <span class="number">9090</span>     write two intel nops</span><br><span class="line">| wxf -|file  write contents <span class="keyword">of</span> hexpairs file here</span><br><span class="line">| wxs <span class="number">9090</span>    write hexpairs and seek at the end</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; </span><br></pre></td></tr></table></figure>
<p>修改为0</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0x00000000</span>]&gt; x <span class="number">16</span> @ <span class="number">0xcddd0000</span>+<span class="number">0xd0c4</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xcdddd0c4</span>  a897 a1cb <span class="number">0100</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; wx <span class="number">000000000000</span> @ <span class="number">0xcddd0000</span>+<span class="number">0xd0c4</span></span><br><span class="line">[<span class="number">0x00000000</span>]&gt; x <span class="number">16</span> @ <span class="number">0xcddd0000</span>+<span class="number">0xd0c4</span></span><br><span class="line">- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  0123456789ABCDEF</span><br><span class="line"><span class="number">0xcdddd0c4</span>  <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>  ................</span><br><span class="line">[<span class="number">0x00000000</span>]&gt; </span><br></pre></td></tr></table></figure>
<p>然后再hook一次</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">c768dd98  <span class="number">35</span> 6c <span class="number">30</span> <span class="number">57</span> <span class="number">58</span> 6e <span class="number">68</span> <span class="number">69</span> <span class="number">59</span> <span class="number">34</span> <span class="number">70</span> 4a <span class="number">37</span> <span class="number">39</span> <span class="number">34</span> 4b  5l0WXnhiY4pJ794K</span><br><span class="line">c768dda8  <span class="number">49</span> 4a <span class="number">37</span> <span class="number">52</span> <span class="number">77</span> <span class="number">35</span> <span class="number">46</span> <span class="number">34</span> <span class="number">35</span> <span class="number">56</span> <span class="number">58</span> <span class="number">67</span> <span class="number">39</span> <span class="number">73</span> 6a 6f  IJ7Rw5F45VXg9sjo</span><br><span class="line">c768ddb8  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br><span class="line">c768ddc8  <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  ................</span><br></pre></td></tr></table></figure>
<p>可以看到返回值就是g_from，既然不知道dword_D0C4是从哪赋值的那就自己生成吧</p>
<h2 id="0x4-5-sub-451C"><a href="#0x4-5-sub-451C" class="headerlink" title="0x4.5 sub_451C"></a>0x4.5 sub_451C</h2><p><img src="images/ida_pro_sub_451c.png"></p>
<p>这里有几个方法的调用，先不管，统统hook一遍；hook之前记得把<code>dword_D0C4</code>地址内容置00</p>
<p><code>sub_4142</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base = Module.getBaseAddress(<span class="string">&quot;libwbutil.so&quot;</span>);</span><br><span class="line">Interceptor.attach(ptr(base.add(<span class="number">0x4124</span>+<span class="number">1</span>)), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    onLeave: <span class="function"><span class="keyword">function</span>(<span class="params">retval</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">        sh(retval, <span class="number">64</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">c5f4f140  <span class="number">37</span> <span class="number">30</span> <span class="number">34</span> <span class="number">65</span> <span class="number">36</span> <span class="number">63</span> <span class="number">31</span> <span class="number">62</span> <span class="number">00</span> <span class="number">00</span> 6f <span class="number">00</span> 0a <span class="number">16</span> <span class="number">00</span> <span class="number">00</span>  704e6c1b..o.....</span><br><span class="line">c5f4f150  <span class="number">61</span> <span class="number">73</span> <span class="number">73</span> <span class="number">65</span> <span class="number">74</span> <span class="number">73</span> 2f <span class="number">63</span> <span class="number">66</span> <span class="number">67</span> 2e 6a <span class="number">73</span> 6f 6e <span class="number">00</span>  assets/cfg.json.</span><br><span class="line">c5f4f160  2e <span class="number">64</span> <span class="number">65</span> <span class="number">62</span> <span class="number">75</span> <span class="number">67</span> 5f 6c <span class="number">69</span> 6e <span class="number">65</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>  .debug_line.....</span><br><span class="line">c5f4f170  2e <span class="number">64</span> <span class="number">65</span> <span class="number">62</span> <span class="number">75</span> <span class="number">67</span> 5f 6c <span class="number">69</span> 6e <span class="number">65</span> <span class="number">00</span> <span class="number">67</span> <span class="number">73</span> <span class="number">00</span> <span class="number">00</span>  .debug_line.gs..</span><br></pre></td></tr></table></figure>

<p><code>mbedtls_decode</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">&quot;libwbutil.so&quot;</span>, <span class="string">&quot;mbedtls_decode&quot;</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">&#x27;mbedtls_decode(&#x27;</span>.concat(Memory.readCString(args[<span class="number">0</span>]))</span><br><span class="line">                    + <span class="string">&quot;, &quot;</span>.concat(args[<span class="number">1</span>])</span><br><span class="line">                    + <span class="string">&quot;, &quot;</span>.concat(args[<span class="number">2</span>])</span><br><span class="line">                    + <span class="string">&quot;, &quot;</span>.concat(args[<span class="number">3</span>]) + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        sh(args[<span class="number">2</span>], <span class="number">16</span>);</span><br><span class="line">        sh(args[<span class="number">3</span>], <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>output:</p>
<p><img src="images/frida_mbedtls_decode_output.png"></p>
<p>经过hook + 分析后可以断定这个方法的作用就是为了解密那串十六进制字符串；</p>
<p>在<code>mbedtls_decode</code>方法中有一个行代码是des解密，使用的是mbedtls_des_crypt_ecb，这个方法在google一搜就能找到对应的<a target="_blank" rel="noopener" href="https://tls.mbed.org/api/des_8h.html">doc</a>，好像是mbedtls库里的一个方法，这个库没用过所以不熟悉。</p>
<p>从api解释可以看出这是一个des ecb模式加解密方法</p>
<p><img src="images/mbedtls_des_crypt_ecb_doc.png"></p>
<blockquote>
<p>第一个参数是des的上下文;</p>
<p>第二个参数是8个字节(64bit)的输入;</p>
<p>第三个参数是8个字节(64bit)的输出;</p>
</blockquote>
<p>是解密还是加密可以从上面的 <code>mbedtls_des_setkey_dec</code> 猜到，这是解密</p>
<p><img src="images/mbedtls_des_setkey_dec_doc.png"></p>
<p>那就需要获取到这个key了，从上图可以看出第二个参数就是key</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Interceptor.attach(Module.findExportByName(<span class="string">&quot;libwbutil.so&quot;</span>, <span class="string">&quot;mbedtls_des_setkey_dec&quot;</span>), &#123;</span><br><span class="line">    onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">        sh(args[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">           <span class="number">0</span>  <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">cea66290  <span class="number">37</span> <span class="number">30</span> <span class="number">34</span> <span class="number">65</span> <span class="number">36</span> <span class="number">63</span> <span class="number">31</span> <span class="number">62</span> <span class="number">00</span> a5 e0 <span class="number">46</span> d9 fc a6 bd  704e6c1b...F....</span><br></pre></td></tr></table></figure>
<p>des的key长度是8个字节，所以key是<code>704e6c1b</code></p>
<p>有了key知道模式就很简单了。</p>
<h1 id="0x5-算法还原"><a href="#0x5-算法还原" class="headerlink" title="0x5 算法还原"></a>0x5 算法还原</h1><p>4种语言总有看得懂的把</p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java:"></a>Java:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.lang.StringBuilder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span>[] TEMP = <span class="string">&quot;0123456789ABCDEF&quot;</span>.toCharArray();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY2 = <span class="string">&quot;109C195010&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UID = <span class="string">&quot;7358119308&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY1 = <span class="string">&quot;5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo&quot;</span> + UID + KEY2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        String key2_s = sha512(KEY2).toLowerCase();</span><br><span class="line">        String key1_s = sha512(KEY1).toLowerCase();</span><br><span class="line">        System.out.println(<span class="string">&quot;KEY1:&quot;</span> + key1_s + <span class="string">&quot;(&quot;</span> + KEY1 + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;KEY2:&quot;</span> + key2_s + <span class="string">&quot;(&quot;</span> + KEY2 + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        <span class="keyword">char</span> bytes[] = key2_s.toCharArray();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, k = <span class="number">0</span>;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            k = converByte2Int(bytes[j]);</span><br><span class="line">            System.out.println(k);</span><br><span class="line">            j += k;</span><br><span class="line">            sb.append(key1_s.charAt(j));</span><br><span class="line">            i += <span class="number">4</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span> (i!=<span class="number">32</span>);</span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">converByte2Int</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a - <span class="number">48</span> &lt;= <span class="number">9</span>) <span class="keyword">return</span> a - <span class="number">48</span>;</span><br><span class="line">        <span class="keyword">if</span> (a - <span class="number">65</span> &gt; <span class="number">5</span>) <span class="keyword">return</span> a - <span class="number">87</span>;</span><br><span class="line">        <span class="keyword">return</span> a - <span class="number">55</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sha512</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MessageDigest sha512 = MessageDigest.getInstance(<span class="string">&quot;SHA-512&quot;</span>);</span><br><span class="line">            sha512.update(text.getBytes());</span><br><span class="line">            String ret = bytes2hex(sha512.digest());</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bytes2hex</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] hexChars = <span class="keyword">new</span> <span class="keyword">char</span>[bytes.length * <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; bytes.length; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> v = bytes[j] &amp; <span class="number">0xFF</span>;</span><br><span class="line">            hexChars[j * <span class="number">2</span>] = TEMP[v&gt;&gt;<span class="number">4</span>];</span><br><span class="line">            hexChars[j * <span class="number">2</span> + <span class="number">1</span>] = TEMP[v&amp;<span class="number">0x0f</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(hexChars);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Golang"><a href="#Golang" class="headerlink" title="Golang:"></a>Golang:</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;crypto/sha512&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> KEY = <span class="string">&quot;5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo&quot;</span></span><br><span class="line"><span class="keyword">var</span> UID = <span class="string">&quot;1014653719052&quot;</span></span><br><span class="line"><span class="keyword">var</span> KEY2 = <span class="string">&quot;109A395010&quot;</span></span><br><span class="line"><span class="keyword">var</span> KEY1 = KEY + UID + KEY2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">enSha512</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%x&quot;</span>, sha512.Sum512([]<span class="keyword">byte</span>(text)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getIndex</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> ret <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="keyword">int</span></span><br><span class="line">    bytes := []<span class="keyword">byte</span>(text)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ &#123;</span><br><span class="line">        k := converByte2Int(<span class="keyword">int</span>(bytes[j]))</span><br><span class="line">        j += k</span><br><span class="line">        ret += fmt.Sprintf(<span class="string">&quot;%x&quot;</span>, k)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">converByte2Int</span><span class="params">(b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">48</span> &lt;= <span class="number">9</span> &#123; <span class="keyword">return</span> b - <span class="number">48</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">65</span> &gt; <span class="number">5</span> &#123; <span class="keyword">return</span> b - <span class="number">87</span> &#125;</span><br><span class="line">    <span class="keyword">return</span> b - <span class="number">55</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    key1_s := enSha512(KEY1)</span><br><span class="line">    key2_s := enSha512(KEY2)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;key1: %s(%s)\n&quot;</span>, key1_s, KEY1)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;key2: %s(%s)\n&quot;</span>, key2_s, KEY2)</span><br><span class="line">    <span class="comment">// key2_s byte array</span></span><br><span class="line">    k2si_ba := getIndex(key2_s)</span><br><span class="line">    <span class="keyword">var</span> result <span class="keyword">string</span></span><br><span class="line">    <span class="keyword">var</span> j <span class="keyword">uint64</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="keyword">range</span> k2si_ba &#123;</span><br><span class="line">        index, _ := strconv.ParseUint(<span class="keyword">string</span>(k2si_ba[i]), <span class="number">16</span>, <span class="number">32</span>)</span><br><span class="line">        j += index</span><br><span class="line">        result += <span class="keyword">string</span>(key1_s[j])</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="string">&quot;s: &quot;</span>, result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="C-（sha512-h太长了，直接去github下载把）"><a href="#C-（sha512-h太长了，直接去github下载把）" class="headerlink" title="C++（sha512.h太长了，直接去github下载把）:"></a>C++（<code>sha512.h太长了，直接去github下载把</code>）:</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sha512.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> sw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> string UID = <span class="string">&quot;5715174600&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> string FROM = <span class="string">&quot;109C295010&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> string KEY = <span class="string">&quot;5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo&quot;</span> + UID + FROM;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">converByte2Int</span><span class="params">(<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b - <span class="number">48</span> &lt;= <span class="number">9</span>) <span class="keyword">return</span> b - <span class="number">48</span>;</span><br><span class="line">    <span class="keyword">if</span> (b - <span class="number">64</span> &gt; <span class="number">5</span>) <span class="keyword">return</span> b - <span class="number">87</span>;</span><br><span class="line">    <span class="keyword">return</span> b - <span class="number">55</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> string k_s = sha512::<span class="built_in">calculate</span>(KEY);</span><br><span class="line">    <span class="keyword">const</span> string f_s = sha512::<span class="built_in">calculate</span>(FROM);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        k = <span class="built_in">converByte2Int</span>(<span class="built_in"><span class="keyword">int</span></span>(f_s[i]));</span><br><span class="line">        i += k;</span><br><span class="line">        j += <span class="number">4</span>;</span><br><span class="line">        cout &lt;&lt; k_s[i];</span><br><span class="line">    &#125; <span class="keyword">while</span>(j != <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Python"><a href="#Python" class="headerlink" title="Python:"></a>Python:</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEY2 = <span class="string">&quot;109A395010&quot;</span></span><br><span class="line">UID = <span class="string">&quot;1014653719052&quot;</span></span><br><span class="line">KEY1 = <span class="string">&quot;5l0WXnhiY4pJ794KIJ7Rw5F45VXg9sjo%s%s&quot;</span> % (UID, KEY2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">converByte2Int</span>(<span class="params">b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">48</span> &lt;= <span class="number">9</span>: <span class="keyword">return</span> b - <span class="number">48</span></span><br><span class="line">    <span class="keyword">if</span> b - <span class="number">65</span> &gt; <span class="number">5</span>: <span class="keyword">return</span> b - <span class="number">87</span></span><br><span class="line">    <span class="keyword">return</span> a - <span class="number">55</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    key1_s = hashlib.sha512(KEY1.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    key2_s = hashlib.sha512(KEY2.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;KEY1: <span class="subst">&#123;key1_s&#125;</span> (<span class="subst">&#123;KEY1&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;KEY2: <span class="subst">&#123;key2_s&#125;</span> (<span class="subst">&#123;KEY2&#125;</span>)&quot;</span>)</span><br><span class="line">    ret = <span class="string">&quot;&quot;</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        k = converByte2Int(<span class="built_in">ord</span>(key2_s[j]))</span><br><span class="line">        j += k</span><br><span class="line">        ret += key1_s[j]</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><ul>
<li>项目地址：<a target="_blank" rel="noopener" href="https://github.com/ZCKun/Weibo">https://github.com/ZCKun/Weibo</a></li>
<li>WebSite: <a target="_blank" rel="noopener" href="http://2h0n9.com/">2h0n9</a></li>
<li>WeChat公众号: the2h0Ng</li>
<li>WeChat: zlztxwd</li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%AD%A3%E6%96%87"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">0x1 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">0x2 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-1-gt-help"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">0x2.1&gt; help</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-2-gt-dm"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">0x2.2&gt; dm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x2-3-gt-iE"><span class="toc-number">2.2.0.3.</span> <span class="toc-text">0x2.3&gt; iE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-24-gt"><span class="toc-number">2.2.0.4.</span> <span class="toc-text">0x.24&gt; \&#x2F;</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x3-Dynamic"><span class="toc-number">2.3.</span> <span class="toc-text">0x3 Dynamic</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x3-1-gt-dma"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">0x3.1&gt; dma</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-gt-dtf-trace-function-from-address"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.2&gt; dtf (trace function from address)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x4-Memory"><span class="toc-number">3.</span> <span class="toc-text">0x4 Memory</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-1-getOriginalString"><span class="toc-number">3.1.</span> <span class="toc-text">0x4.1 getOriginalString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-2-getKeyString"><span class="toc-number">3.2.</span> <span class="toc-text">0x4.2 getKeyString</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-3-getIndex"><span class="toc-number">3.3.</span> <span class="toc-text">0x4.3 getIndex</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-4-g-pin%E3%80%81g-from"><span class="toc-number">3.4.</span> <span class="toc-text">0x4.4 g_pin、g_from</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x4-5-sub-451C"><span class="toc-number">3.5.</span> <span class="toc-text">0x4.5 sub_451C</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x5-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F"><span class="toc-number">4.</span> <span class="toc-text">0x5 算法还原</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">4.0.1.</span> <span class="toc-text">Java:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Golang"><span class="toc-number">4.0.2.</span> <span class="toc-text">Golang:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-%EF%BC%88sha512-h%E5%A4%AA%E9%95%BF%E4%BA%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%8E%BBgithub%E4%B8%8B%E8%BD%BD%E6%8A%8A%EF%BC%89"><span class="toc-number">4.0.3.</span> <span class="toc-text">C++（sha512.h太长了，直接去github下载把）:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">4.0.4.</span> <span class="toc-text">Python:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">5.</span> <span class="toc-text">最后</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&text=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&is_video=false&description=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&body=Check out this article: http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&title=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://zckun.github.io/2019/12/21/radara-plus-frida-equals-r2friad-191221/&name=RADARE2+FRIDA=R2FRIDA Your Best Dynamic Debugging Tool&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 0x2h
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

    <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?b1bcce32f51ad876ecf02282881e609b";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

<!-- Disqus Comments -->


</body>
</html>
